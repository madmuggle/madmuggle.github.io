# 关于消息软件的一些要点
2017/03/07 10:23:00


## 开发感悟

前一段时间因工作需要，编写了一个简单的即时通讯服务。开发过程中有一些收获，趁记忆还算新鲜，特写下一篇博客做个记录。

消息软件有一个很容易被忽略的特性：消息的暂存。不论是SMS，Email，IM等等，都提供了这种功能：你不在线消息不会丢失，下次登录一起发给你。

这个功能看上去理所应当，但实际动手去实现的话，它是整个消息系统中最麻烦的一部分。处理得不周到，消息就可能丢失。

相比之下，使用TCP还是UDP，重连，组包等等都属于相对简单的部分了。


## Socket.io & RabbitMQ

那个消息系统是作为一个网页应用开发的，由于HTTP的特殊性，消息的推送成了个大问题，为了保证兼容性，最终选择了使用Socket.io作为基础。

这个选择带给了我很多误导，现在看来很简单，但刚开始开发的时候，什么概念都没有，确实走了点弯路。

Socket.io的官网提供了各种模式的聊天服务实例，一对一的，聊天室的…… 我起初以为这就足以满足我的需求了。然而实际使用立马就会发现问题。

Socket.io不支持消息的暂存。

也就是如果用户没有登录，那这段时间，“群”里的聊天消息他都看不到了。这是不合逻辑的。Socket.io提供的那些东西，本身就不是为了开发全功能IM软件。

最后引入RabbitMQ，Socket.io只是作为向浏览器推送的一个手段，这才顺利完成了开发任务。


