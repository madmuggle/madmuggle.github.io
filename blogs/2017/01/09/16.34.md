# Go语言的数组也是“值”而非“引用”



## 相似不只语法

曾在网上看到有一篇文章说Swift的数组变量是“值”而非“引用”，当时有点儿意外，因为之前接触到的所有语言，都不是这样设计的。

C/C++的数组变量是引用。Java除了基本整数类型是值，其他都是引用。Python等动态语言更甚，所有变量都是引用。

今天发现Go语言的数组也是“值”，跟Swift一样。看来它们俩不仅仅是语法相似。先来一个小实验来让它现形：

```go
var a, b [3]int

a = [3]int{1, 2, 3}
b = a
b[1] = 9
```

打印`a`和`b`看看：
```go
fmt.Println("a:", a)
fmt.Println("b:", b)
```

运行结果是：
```
a: [1 2 3]
b: [1 9 3]
```

可以看到`b = a`进行了数组的拷贝。所以数组变量是“值”。


## 奇怪还是统一

“数组”和“结构体”是当今计算机架构上最基本，最自然的数据结构，排名不分先后。其他的数据结构不管名气多大，功能多强，都是建立在它们之上。

然而除了C/C++，Go，很少有语言允许你直接建立“纯”的数组或结构体，也就是那种直接能够映射到内存结构的形式。

Java的“结构体”叫“类”，内存布局上和C的结构体一致，但它的数组有限制，只可能是“指针数组”，存的是对象的引用。

Python，Ruby这类动态语言，根本没有“结构体”，只有哈希表。它们的数组也是指针数组，而且会在自动扩容！无法预料它会在什么时候进行拷贝。

在这种环境下待久了，真觉得C语言是一股清流。然而C语言却有个奇怪的规定：数组变量是引用，结构体变量是值。

本质上“数组”和“结构体”都是连续的内存空间，只是数组元素定长，结构体元素长度不定。这样区别对待是违反直觉的。

Go把事情做对了：既然结构体变量是“值”，那么数组变量也要是“值”。

这样一来，“数组”，“结构体”甚至和“整数”这种基本元素统一了起来，既然它们都是基本元素，就都设计成“值”吧。

我觉得Go的这种做法挺好。


